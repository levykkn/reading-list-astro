---
import MainLayout from '../../layouts/MainLayout.astro';
import { getPosts, urlFor } from '../../lib/sanity';
import type { Post } from '../../types';
import { Image } from 'astro:assets';
import { format } from 'date-fns';

const posts: Post[] = await getPosts();
const featuredPost = posts[0];
const otherPosts = posts.slice(1);
---

<MainLayout title="Blog | Reading Lists">
    <header class="text-center mb-16">
        <h1 class="text-4xl sm:text-5xl font-bold tracking-tight text-gray-900">From the Blog</h1>
        <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-500">Insights, articles, and explorations into the world of literature and philosophy.</p>
    </header>

    <main>
        <!-- Featured Post Section -->
        {featuredPost && (
            <section class="mb-16">
                <a href={`/blog/${featuredPost.slug.current}`} class="group grid md:grid-cols-2 gap-8 items-center bg-white border border-gray-200 rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden p-6">
                    <div class="overflow-hidden rounded-xl">
                        {featuredPost.mainImage && (
                            <Image 
                                src={urlFor(featuredPost.mainImage).url()}
                                alt={`Cover for ${featuredPost.title}`}
                                width={800}  
                                height={500}
                                format="webp"
                                quality={90}
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" 
                            />
                        )}
                    </div>
                    <div class="p-4">
                        <p class="text-sm font-semibold text-gray-800 mb-2">Featured Article</p>
                        <h2 class="text-3xl font-bold text-gray-900 tracking-tight mb-3">{featuredPost.title}</h2>
                        <p class="text-gray-600 text-base mb-6">{featuredPost.excerpt}</p>
                        <div class="flex items-center">
                            {featuredPost.author.picture && (
                                 <Image 
                                    src={urlFor(featuredPost.author.picture).url()}
                                    alt={`Picture of ${featuredPost.author.name}`}
                                    width={40}  
                                    height={40}
                                    format="webp"
                                    class="w-10 h-10 rounded-full mr-4 object-cover" 
                                />
                            )}
                            <div>
                                <p class="text-sm font-medium text-gray-900">{featuredPost.author.name}</p>
                                <p class="text-sm text-gray-500">{format(new Date(featuredPost.publishedAt), 'MMMM d, yyyy')}</p>
                            </div>
                        </div>
                    </div>
                </a>
            </section>
        )}

        <!-- Other Posts Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {otherPosts.map(post => (
                <article class="group flex flex-col bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 overflow-hidden">
                    <a href={`/blog/${post.slug.current}`} class="block overflow-hidden">
                        {post.mainImage && (
                            <Image 
                                src={urlFor(post.mainImage).url()}
                                alt={`Cover for ${post.title}`}
                                width={600}  
                                height={400}
                                format="webp"
                                quality={80}
                                class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105" 
                            />
                        )}
                    </a>
                    <div class="p-6 flex flex-col flex-grow">
                        <h2 class="text-xl font-bold text-gray-900 tracking-tight mb-2">
                            <a href={`/blog/${post.slug.current}`} class="hover:text-gray-700 transition-colors">{post.title}</a>
                        </h2>
                        <p class="text-gray-600 text-base mb-4 flex-grow">{post.excerpt}</p>
                        <div class="flex items-center mt-auto">
                            {post.author.picture && (
                                 <Image 
                                    src={urlFor(post.author.picture).url()}
                                    alt={`Picture of ${post.author.name}`}
                                    width={40}  
                                    height={40}
                                    format="webp"
                                    class="w-10 h-10 rounded-full mr-4 object-cover" 
                                />
                            )}
                            <div>
                                <p class="text-sm font-medium text-gray-900">{post.author.name}</p>
                                <p class="text-sm text-gray-500">{format(new Date(post.publishedAt), 'MMMM d, yyyy')}</p>
                            </div>
                        </div>
                    </div>
                </article>
            ))}
        </div>
    </main>
</MainLayout>

